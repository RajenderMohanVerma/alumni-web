{% extends "base.html" %}

{% block title %}Register - DBIT Alumni Hub{% endblock %}

{% block content %}
<link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

<div class="position-relative overflow-hidden min-vh-100 d-flex align-items-center justify-content-center py-5"
    style="padding-top: 250px;">

    <!-- Animated Mesh Background -->
    <div class="mesh-background">
        <div class="mesh-ball ball-1"></div>
        <div class="mesh-ball ball-2"></div>
        <div class="mesh-ball ball-3"></div>
        <div class="mesh-ball ball-4"></div>
    </div>

    <!-- Container -->
    <div class="container position-relative z-2">
        <div class="row justify-content-center">
            <div class="col-xl-11 col-lg-12">

                <!-- Glassmorphic Card -->
                <div class="card-modern glass-panel reveal-fade shadow-2xl"
                    style="border-radius: 30px; overflow: hidden; height: 85vh; min-height: 700px; border: 1px solid rgba(255,255,255,0.4);">
                    <div class="row g-0 h-100">

                        <!-- LEFT SIDE: Branding (Sticky) -->
                        <div
                            class="col-lg-4 d-none d-lg-flex flex-column justify-content-center align-items-center text-center p-5 position-relative overflow-hidden bg-gradient-premium">
                            <div class="absolute-bg-animation"></div>

                            <div class="position-relative z-1 reveal-fade" style="transition-delay: 0.2s;">
                                <div class="mb-5">
                                    <div class="icon-circle bg-white text-primary rounded-circle d-flex align-items-center justify-content-center mx-auto shadow-lg"
                                        style="width: 100px; height: 100px; font-size: 2.5rem; animation: pulse-slow 3s infinite;">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                </div>
                                <h2 class="fw-bold display-6 mb-3 text-white">Join the <br>Community</h2>
                                <p class="lead text-white-50 mb-5 text-sm">Unlock exclusive opportunities, mentorship,
                                    and lifelong connections.</p>

                                <ul class="list-unstyled text-start w-75 mx-auto text-white-50">
                                    <li class="mb-3 d-flex align-items-center"><i
                                            class="fas fa-check-circle text-warning me-3"></i> Expand your network</li>
                                    <li class="mb-3 d-flex align-items-center"><i
                                            class="fas fa-check-circle text-warning me-3"></i> Find mentors & jobs</li>
                                    <li class="mb-3 d-flex align-items-center"><i
                                            class="fas fa-check-circle text-warning me-3"></i> Stay updated</li>
                                </ul>
                            </div>

                            <div class="mt-auto position-relative z-1">
                                <a href="/" class="text-white text-decoration-none hover-item small"><i
                                        class="fas fa-arrow-left me-2"></i> Back to Home</a>
                            </div>
                        </div>

                        <!-- RIGHT SIDE: Scrollable Form -->
                        <div class="col-lg-8 h-100 bg-white position-relative">

                            <!-- Progress Bar -->
                            <div class="progress-container position-absolute top-0 start-0 w-100 z-3"
                                style="height: 6px; background: #f1f5f9;">
                                <div id="form-progress" class="progress-bar-premium"
                                    style="width: 0%; height: 100%; background: linear-gradient(90deg, #6366f1, #ec4899); transition: width 0.3s ease;">
                                </div>
                            </div>

                            <div class="h-100 overflow-y-auto custom-scrollbar p-5">

                                <div class="d-flex justify-content-between align-items-end mb-5">
                                    <div>
                                        <h2 class="fw-bold text-dark mb-1 font-heading">Create Account</h2>
                                        <p class="text-muted mb-0">It only takes a minute.</p>
                                    </div>
                                    <span class="badge bg-light text-primary border rounded-pill px-3 py-2"
                                        id="completion-badge">0% Completed</span>
                                </div>

                                {% with messages = get_flashed_messages(with_categories=true) %}
                                {% if messages %}
                                {% for category, message in messages %}
                                <div class="alert alert-{{ category }} fade show mb-4 border-0 shadow-sm rounded-3"
                                    role="alert">
                                    <i class="fas fa-info-circle me-2"></i> {{ message }}
                                </div>
                                {% endfor %}
                                {% endif %}
                                {% endwith %}

                                <form method="POST" id="registerForm" class="needs-validation"
                                    onsubmit="return validateRegisterForm()">

                                    <!-- Role Selection -->
                                    <div class="mb-5 section-fade">
                                        <label
                                            class="form-label fw-bold small text-uppercase text-muted tracking-wide mb-3">I
                                            am a...</label>
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <input type="radio" class="btn-check" name="role" id="roleStudent"
                                                    value="student" {% if role=='student' %}checked{% endif %}
                                                    onchange="updateFormFields()">
                                                <label
                                                    class="card-role w-100 p-4 text-center cursor-pointer rounded-4 border"
                                                    for="roleStudent">
                                                    <i class="fas fa-graduation-cap fa-2x mb-3 text-primary"></i>
                                                    <div class="fw-bold">Student</div>
                                                </label>
                                            </div>
                                            <div class="col-md-4">
                                                <input type="radio" class="btn-check" name="role" id="roleAlumni"
                                                    value="alumni" {% if role=='alumni' %}checked{% endif %}
                                                    onchange="updateFormFields()">
                                                <label
                                                    class="card-role w-100 p-4 text-center cursor-pointer rounded-4 border"
                                                    for="roleAlumni">
                                                    <i class="fas fa-user-tie fa-2x mb-3 text-success"></i>
                                                    <div class="fw-bold">Alumni</div>
                                                </label>
                                            </div>
                                            <div class="col-md-4">
                                                <input type="radio" class="btn-check" name="role" id="roleFaculty"
                                                    value="faculty" {% if role=='faculty' %}checked{% endif %}
                                                    onchange="updateFormFields()">
                                                <label
                                                    class="card-role w-100 p-4 text-center cursor-pointer rounded-4 border"
                                                    for="roleFaculty">
                                                    <i class="fas fa-chalkboard-teacher fa-2x mb-3 text-warning"></i>
                                                    <div class="fw-bold">Faculty</div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Basic Info -->
                                    <div class="mb-5">
                                        <h5 class="fw-bold text-dark mb-4 pb-2 border-bottom">Basic Information</h5>
                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold small text-muted">Full Name</label>
                                                <input type="text"
                                                    class="form-control form-control-lg bg-light border-0" id="name"
                                                    name="name" required placeholder="John Doe">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold small text-muted">Email Address</label>
                                                <input type="email"
                                                    class="form-control form-control-lg bg-light border-0" id="email"
                                                    name="email" required placeholder="john@example.com">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold small text-muted">Phone Number</label>
                                                <input type="tel" class="form-control form-control-lg bg-light border-0"
                                                    id="phone" name="phone" required placeholder="+91 9876543210">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold small text-muted">Password</label>
                                                <input type="password"
                                                    class="form-control form-control-lg bg-light border-0" id="password"
                                                    name="password" required placeholder="••••••••">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Dynamic Fields (Hidden by default) -->
                                    <div id="studentFields" style="display: none;" class="mb-5 animate-slide-down">
                                        <h5 class="fw-bold text-primary mb-4 pb-2 border-bottom">Student Details</h5>
                                        <div class="row g-4">
                                            <div class="col-md-6"><label
                                                    class="form-label small fw-bold text-muted">Enrollment
                                                    No</label><input type="text" class="form-control bg-light border-0"
                                                    name="enrollment_no"></div>
                                            <!-- Additional fields layout similar to basic info, using standard labels and inputs -->
                                            <div class="col-md-6">
                                                <label class="form-label small fw-bold text-muted">Category</label>
                                                <select class="form-select bg-light border-0" id="category"
                                                    name="category" onchange="updateCourseDropdown()">
                                                    <option value="">Select Category</option>
                                                    <option value="IT">IT / Technology</option>
                                                    <option value="Engineering">Engineering</option>
                                                    <!-- ... options ... -->
                                                </select>
                                            </div>
                                            <!-- ... Repeat for other dropdowns styling ... -->
                                            <div class="col-md-6">
                                                <label class="form-label small fw-bold text-muted">Level</label>
                                                <select class="form-select bg-light border-0" id="level" name="level"
                                                    onchange="updateCourseDropdown()">
                                                    <option value="">Select Level</option>
                                                    <option value="UG">Undergraduate</option>
                                                    <option value="PG">Postgraduate</option>
                                                    <option value="Diploma">Diploma</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label small fw-bold text-muted">Course</label>
                                                <select class="form-select bg-light border-0" id="degree" name="degree">
                                                    <option value="">Select Course</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label small fw-bold text-muted">Department</label>
                                                <select class="form-select bg-light border-0" id="department"
                                                    name="department">
                                                    <option value="">Select Department</option>
                                                    <option value="Information Technology">IT</option>
                                                    <option value="Computer Science">CS</option>
                                                    <option value="Computer Engineering">Computer Engg</option>
                                                    <option value="Electronics & Communication">EXTC</option>
                                                    <option value="Mechanical Engineering">Mechanical</option>
                                                    <option value="Civil Engineering">Civil</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label small fw-bold text-muted">Semester</label>
                                                <select class="form-select bg-light border-0" name="semester">
                                                    <option value="">Select Semester</option>
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                    <option value="6">6</option>
                                                    <option value="7">7</option>
                                                    <option value="8">8</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="alumniFields" style="display: none;" class="mb-5 animate-slide-down">
                                        <h5 class="fw-bold text-success mb-4 pb-2 border-bottom">Alumni Details</h5>
                                        <div class="row g-4">
                                            <div class="col-md-6"><label
                                                    class="form-label small fw-bold text-muted">Enrollment
                                                    No</label><input type="text" class="form-control bg-light border-0"
                                                    name="enrollment_no"></div>
                                            <!-- Alumni specific fields -->
                                            <div class="col-md-6"><label
                                                    class="form-label small fw-bold text-muted">Passing Year</label>
                                                <select class="form-select bg-light border-0" name="pass_year">
                                                    {% for year in range(2024, 1999, -1) %}<option value="{{ year }}">{{
                                                        year }}</option>{% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-md-6"><label
                                                    class="form-label small fw-bold text-muted">Current
                                                    Company</label><input type="text"
                                                    class="form-control bg-light border-0" name="company_name"></div>
                                            <div class="col-md-6"><label
                                                    class="form-label small fw-bold text-muted">Designation</label><input
                                                    type="text" class="form-control bg-light border-0"
                                                    name="designation"></div>
                                        </div>
                                    </div>

                                    <div id="facultyFields" style="display: none;" class="mb-5 animate-slide-down">
                                        <h5 class="fw-bold text-warning mb-4 pb-2 border-bottom">Faculty Details</h5>
                                        <div class="row g-4">
                                            <div class="col-md-6"><label
                                                    class="form-label small fw-bold text-muted">Employee
                                                    ID</label><input type="text" class="form-control bg-light border-0"
                                                    name="employee_id"></div>
                                            <div class="col-md-6"><label
                                                    class="form-label small fw-bold text-muted">Department</label>
                                                <select class="form-select bg-light border-0" name="department">
                                                    <option value="">Select Department</option>
                                                    <option value="Information Technology">IT</option>
                                                    <option value="Computer Science">CS</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6"><label
                                                    class="form-label small fw-bold text-muted">Designation</label>
                                                <select class="form-select bg-light border-0" name="designation">
                                                    <option value="Professor">Professor</option>
                                                    <option value="Assistant Professor">Assistant Professor</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <button type="submit"
                                        class="btn btn-primary btn-lg w-100 py-3 fw-bold shadow-lg hover-lift"
                                        style="border-radius: 12px; background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); border: none;">
                                        Create Account <i class="fas fa-arrow-right ms-2"></i>
                                    </button>

                                    <div class="text-center mt-4 text-muted">
                                        Already have an account? <a href="/login"
                                            class="fw-bold text-primary text-decoration-none">Login Here</a>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<style>
    .card-role {
        transition: all 0.3s ease;
        border-color: #e2e8f0;
    }

    .btn-check:checked+.card-role {
        border-color: #6366f1;
        background-color: #eff6ff;
        color: #4f46e5;
        box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.1), 0 2px 4px -1px rgba(99, 102, 241, 0.06);
    }

    .form-control:focus,
    .form-select:focus {
        background-color: #fff !important;
        border: 1px solid #6366f1 !important;
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1) !important;
    }

    .animate-slide-down {
        animation: slideDown 0.4s ease-out;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

<style>
    /* Role Card Styles */
    .card-role {
        background: rgba(255, 255, 255, 0.5);
        border: 2px solid transparent;
        border-radius: 12px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .card-role:hover {
        background: rgba(255, 255, 255, 0.8);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .btn-check:checked+.card-role {
        background: rgba(99, 102, 241, 0.1);
        border-color: #6366f1;
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
    }

    .role-icon {
        font-size: 1.5rem;
        color: #64748b;
        transition: all 0.3s ease;
    }

    .btn-check:checked+.card-role .role-icon {
        color: #6366f1;
        transform: scale(1.1);
    }

    .role-name {
        font-weight: 600;
        color: #1e293b;
    }

    .role-check {
        position: absolute;
        top: 8px;
        right: 8px;
        color: #6366f1;
        opacity: 0;
        font-size: 0.8rem;
        transform: scale(0);
        transition: all 0.3s ease;
    }

    .btn-check:checked+.card-role .role-check {
        opacity: 1;
        transform: scale(1);
    }

    /* Inner Glass Container */
    .glass-inner {
        background: rgba(255, 255, 255, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.6);
    }

    /* Custom Scrollbar for Form Area */
    .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.02);
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.2);
        border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.4);
    }

    /* Reveal Animation for Progress Bar */
    @keyframes progressGlow {
        0% {
            box-shadow: 0 0 5px rgba(99, 102, 241, 0.5);
        }

        50% {
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.7);
        }

        100% {
            box-shadow: 0 0 5px rgba(99, 102, 241, 0.5);
        }
    }

    .progress-bar-premium {
        animation: progressGlow 2s infinite;
    }

    /* Floating Icons Animation */
    @keyframes floatIcon {

        0%,
        100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-15px);
        }
    }

    .floating-icon {
        animation: floatIcon 4s ease-in-out infinite;
        pointer-events: none;
    }

    .icon-1 {
        animation-delay: 0s;
    }

    .icon-2 {
        animation-delay: 1.5s;
    }

    .icon-3 {
        animation-delay: 2.5s;
    }

    .cursor-blink {
        animation: blink 0.7s infinite;
    }

    @keyframes blink {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0;
        }
    }
</style>

<script>
    // Course data (kept exactly as original)
    const courseData = {
        'IT': {
            'UG': ['BCA – Bachelor of Computer Applications', 'B.Sc Computer Science', 'B.Sc Information Technology', 'B.Tech Computer Science Engineering', 'B.Tech Information Technology', 'B.Tech AI & ML', 'B.Tech Data Science', 'B.Tech Cyber Security', 'B.Tech Cloud Computing', 'B.Tech Software Engineering', 'B.Tech IoT', 'B.Tech Computer Engineering', 'B.Tech Blockchain Technology'],
            'PG': ['MCA – Master of Computer Applications', 'M.Sc Computer Science', 'M.Sc Information Technology', 'M.Tech Computer Science', 'M.Tech Information Technology', 'M.Tech AI / ML', 'M.Tech Data Science', 'M.Tech Cyber Security'],
            'Diploma': ['Diploma in Computer Engineering', 'Diploma in Information Technology', 'Diploma in Software Engineering', 'Full Stack Development', 'Data Science', 'AI / ML', 'Cyber Security', 'Cloud Computing']
        },
        'Engineering': {
            'UG': ['B.Tech Mechanical Engineering', 'B.Tech Civil Engineering', 'B.Tech Electrical Engineering', 'B.Tech Electronics & Communication (ECE)', 'B.Tech Electronics & Instrumentation', 'B.Tech Automobile Engineering', 'B.Tech Chemical Engineering', 'B.Tech Aerospace Engineering', 'B.Tech Biomedical Engineering'],
            'PG': ['M.Tech Mechanical Engineering', 'M.Tech Civil Engineering', 'M.Tech Electrical Engineering', 'M.Tech Electronics Engineering', 'M.Tech Structural Engineering', 'M.Tech Thermal Engineering']
        },
        'Science': {
            'UG': ['B.Sc Mathematics', 'B.Sc Physics', 'B.Sc Chemistry', 'B.Sc Biotechnology', 'B.Sc Microbiology', 'B.Sc Environmental Science'],
            'PG': ['M.Sc Mathematics', 'M.Sc Physics', 'M.Sc Chemistry', 'M.Sc Biotechnology', 'M.Sc Microbiology']
        },
        'Commerce': {
            'UG': ['B.Com', 'BBA – Bachelor of Business Administration', 'BMS – Business Management Studies'],
            'PG': ['M.Com', 'MBA – Master of Business Administration', 'PGDM']
        },
        'Arts': {
            'UG': ['BA (History)', 'BA (Political Science)', 'BA (English)', 'BA (Economics)', 'BA (Sociology)', 'BJMC – Journalism & Mass Communication', 'BFA – Fine Arts'],
            'PG': ['MA (English)', 'MA (History)', 'MA (Political Science)', 'MA (Economics)', 'MA (Sociology)', 'MJMC – Journalism']
        },
        'Medical': {
            'UG': ['MBBS', 'BDS', 'B.Pharm', 'B.Sc Nursing', 'BPT – Physiotherapy', 'BAMS', 'BHMS'],
            'PG': ['MD', 'MS', 'M.Pharm', 'M.Sc Nursing']
        },
        'Law': {
            'UG': ['LLB', 'BA LLB', 'B.Ed', 'Hotel Management (BHM)', 'Fashion Designing', 'Interior Designing'],
            'PG': ['M.Ed', 'D.El.Ed', 'Hotel Management (MHM)']
        }
    };

    function updateFormFields() {
        const roleSelector = document.querySelector('input[name="role"]:checked');
        if (!roleSelector) return;

        const role = roleSelector.value;

        ['student', 'alumni', 'faculty'].forEach(r => {
            const field = document.getElementById(r + 'Fields');
            if (field) {
                if (role === r) {
                    field.style.display = 'block';
                    // Trigger reveal animation slightly after display
                    setTimeout(() => field.classList.add('revealed'), 50);
                } else {
                    field.style.display = 'none';
                    field.classList.remove('revealed');
                }
            }
        });

        // Trigger progress calculation update on role change
        setTimeout(calculateProgress, 100);
    }

    function updateCourseDropdown() {
        const category = document.getElementById('category').value;
        const level = document.getElementById('level').value;
        const degreeSelect = document.getElementById('degree');

        degreeSelect.innerHTML = '<option value="">Select Course</option>';

        if (category && level && courseData[category] && courseData[category][level]) {
            courseData[category][level].forEach(course => {
                const option = document.createElement('option');
                option.value = course;
                option.textContent = course;
                degreeSelect.appendChild(option);
            });
        }
        calculateProgress();
    }

    function updateAlumniCourseDropdown() {
        const category = document.getElementById('alum_category').value;
        const level = document.getElementById('alum_level').value;
        const degreeSelect = document.getElementById('alum_degree');

        degreeSelect.innerHTML = '<option value="">Select Course</option>';

        if (category && level && courseData[category] && courseData[category][level]) {
            courseData[category][level].forEach(course => {
                const option = document.createElement('option');
                option.value = course;
                option.textContent = course;
                degreeSelect.appendChild(option);
            });
        }
        calculateProgress();
    }

    // Progress Bar Calculation
    function calculateProgress() {
        let totalFields = 0;
        let filledFields = 0;

        // Common fields
        const commonInputs = document.querySelectorAll('#name, #email, #phone, #password');
        totalFields += commonInputs.length;
        commonInputs.forEach(input => {
            if (input.value.trim() !== '') filledFields++;
        });

        // Role specific fields
        const roleSelector = document.querySelector('input[name="role"]:checked');
        if (roleSelector) {
            const role = roleSelector.value;
            const roleContainer = document.getElementById(role + 'Fields');
            if (roleContainer) {
                const roleInputs = roleContainer.querySelectorAll('input, select');
                roleInputs.forEach(input => {
                    totalFields++;
                    if (input.value.trim() !== '') filledFields++;
                });
            }
        }

        const percentage = totalFields === 0 ? 0 : Math.round((filledFields / totalFields) * 100);
        const progressBar = document.getElementById('form-progress');
        const badge = document.getElementById('completion-badge');

        if (progressBar) progressBar.style.width = `${percentage}%`;
        if (badge) badge.textContent = `${percentage}% Complete`;

        // Color change based on progress
        if (percentage < 50) {
            if (progressBar) progressBar.style.background = 'linear-gradient(90deg, #ef4444, #f59e0b)';
        } else {
            if (progressBar) progressBar.style.background = 'linear-gradient(90deg, #6366f1, #10b981)';
        }
    }

    // Typing Effect
    const textArray = ["Join Us", "Join the Future", "Join the Community", "Connect Now"];
    let textIndex = 0;
    let charIndex = 0;
    let isDeleting = false;

    function typeEffect() {
        const currentText = textArray[textIndex];
        const typingElement = document.getElementById('typing-text');

        if (isDeleting) {
            typingElement.textContent = currentText.substring(0, charIndex - 1);
            charIndex--;
        } else {
            typingElement.textContent = currentText.substring(0, charIndex + 1);
            charIndex++;
        }

        let typeSpeed = isDeleting ? 100 : 200;

        if (!isDeleting && charIndex === currentText.length) {
            isDeleting = true;
            typeSpeed = 2000; // Pause at end
        } else if (isDeleting && charIndex === 0) {
            isDeleting = false;
            textIndex = (textIndex + 1) % textArray.length;
            typeSpeed = 500;
        }

        setTimeout(typeEffect, typeSpeed);
    }


    document.addEventListener('DOMContentLoaded', () => {
        // Start Typing Effect
        typeEffect();

        // Trigger Initial Reveals
        setTimeout(() => {
            document.querySelectorAll('.reveal-fade').forEach(el => {
                // Only reveal if not hidden by role logic (except initial ones)
                if (el.offsetParent !== null) {
                    el.classList.add('revealed');
                }
            });
        }, 100);

        // Initial form field setup
        updateFormFields();

        // Magnetic Button Logic
        const magneticBtns = document.querySelectorAll('.magnetic-button');
        magneticBtns.forEach(btn => {
            btn.addEventListener('mousemove', (e) => {
                const { left, top, width, height } = btn.getBoundingClientRect();
                const x = (e.clientX - left - width / 2) * 0.3;
                const y = (e.clientY - top - height / 2) * 0.3;
                const glow = btn.querySelector('.btn-glow');

                btn.style.transform = `translate(${x}px, ${y}px)`;
                if (glow) {
                    glow.style.left = `${e.clientX - left}px`;
                    glow.style.top = `${e.clientY - top}px`;
                }
            });
            btn.addEventListener('mouseleave', () => {
                btn.style.transform = 'translate(0, 0)';
            });
        });

        // 3D Parallax Tilt & Glow for Register Card
        const registerCard = document.querySelector('.card-modern');
        if (registerCard) {
            registerCard.addEventListener('mousemove', (e) => {
                const rect = registerCard.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const centerX = rect.width / 2;
                const centerY = rect.height / 2;

                // Subtle tilt
                const rotateX = (y - centerY) / 50;
                const rotateY = (centerX - x) / 50;

                registerCard.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            });

            registerCard.addEventListener('mouseleave', () => {
                registerCard.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
            });
        }

        // --- Floating Label Fix for Overlap (Always-Up Persistence) ---
        const formInputs = document.querySelectorAll('.form-control-modern, .form-select');

        function updateLabel(input) {
            if (input.value && input.value.trim() !== '') {
                input.classList.add('has-content');
            } else {
                input.classList.remove('has-content');
            }
            calculateProgress(); // Also update progress on input change
        }

        formInputs.forEach(input => {
            updateLabel(input);

            input.addEventListener('input', () => updateLabel(input));
            input.addEventListener('change', () => updateLabel(input));
            input.addEventListener('blur', () => updateLabel(input));

            input.addEventListener('animationstart', (e) => {
                if (e.animationName === 'onAutoFillStart') {
                    input.classList.add('has-content');
                    calculateProgress();
                }
            });
        });

        setTimeout(() => {
            formInputs.forEach(updateLabel);
        }, 500);
    });

    // Form Validation Function
    function validateRegisterForm() {
        const role = document.querySelector('input[name="role"]:checked')?.value;
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const password = document.getElementById('password').value;

        // Check common fields
        if (!role) {
            alert('Please select a role');
            return false;
        }

        if (!name || !email || !phone || !password) {
            alert('Please fill in all basic fields (Name, Email, Phone, Password)');
            return false;
        }

        // Check role-specific required fields
        if (role === 'student') {
            const enrollment_no = document.getElementById('enrollment_no').value.trim();
            const category = document.getElementById('category').value;
            const level = document.getElementById('level').value;
            const degree = document.getElementById('degree').value;
            const department = document.getElementById('department').value;

            if (!enrollment_no || !category || !level || !degree || !department) {
                alert('Please fill in all Student required fields');
                return false;
            }
        }
        else if (role === 'alumni') {
            const enrollment_no = document.getElementById('alum_enrollment_no').value.trim();
            const category = document.getElementById('alum_category').value;
            const level = document.getElementById('alum_level').value;
            const degree = document.getElementById('alum_degree').value;
            const department = document.getElementById('alum_department').value;
            const pass_year = document.getElementById('pass_year').value;

            if (!enrollment_no || !category || !level || !degree || !department || !pass_year) {
                alert('Please fill in all Alumni required fields');
                return false;
            }
        }
        else if (role === 'faculty') {
            const employee_id = document.getElementById('employee_id').value.trim();
            const department = document.getElementById('fac_department').value;
            const designation = document.getElementById('fac_designation').value;
            const qualification = document.getElementById('qualification').value.trim();

            if (!employee_id || !department || !designation || !qualification) {
                alert('Please fill in all Faculty required fields');
                return false;
            }
        }

        // Form is valid, allow submission
        return true;
    }

    // Add CSS for 3D logic dynamically
    const style = document.createElement('style');
    style.textContent = `
    .card-modern {
        transform-style: preserve-3d;
        will-change: transform;
        transition: transform 0.1s ease-out;
    }
`;
    document.head.appendChild(style);
</script>
{% endblock %}