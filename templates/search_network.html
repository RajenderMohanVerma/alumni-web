{% extends "base.html" %}

{% block title %}Search Network - DBIT Alumni Hub{% endblock %}

{% block content %}
<div class="search-network-wrapper"
    style="padding-top: 150px; min-height: 100vh; background: #0f172a; position: relative; overflow: hidden;">
    <!-- Abstract Background Elements -->
    <div class="abstract-blobs">
        <div class="blob blob-1"
            style="background: rgba(99, 102, 241, 0.15); width: 600px; height: 600px; left: -100px; top: -100px;"></div>
        <div class="blob blob-2"
            style="background: rgba(236, 72, 153, 0.15); width: 500px; height: 500px; right: -100px; bottom: -100px;">
        </div>
    </div>

    <div class="container" style="position: relative; z-index: 2;">
        <!-- Hero Search Section -->
        <div class="row mb-5" data-aos="fade-down">
            <div class="col-lg-12">
                <div class="glass-panel p-5 text-center"
                    style="border-radius: 32px; border: 1px solid rgba(255,255,255,0.1);">
                    <h1 class="display-5 fw-bold text-white mb-3">
                        <i class="fas fa-search-plus me-3 text-primary"></i>Discover Your <span
                            class="text-gradient-purple">Network</span>
                    </h1>
                    <p class="text-white-50 lead mb-5 mx-auto" style="max-width: 700px;">
                        Find alumni, students, and faculty members. Build connections that last a lifetime.
                    </p>

                    <form method="POST" class="search-form-premium">
                        <div class="row g-3 justify-content-center">
                            <div class="col-lg-7 col-md-8">
                                <div class="input-group input-group-lg shadow-lg"
                                    style="border-radius: 20px; overflow: hidden;">
                                    <span class="input-group-text bg-white border-0 ps-4">
                                        <i class="fas fa-search text-muted"></i>
                                    </span>
                                    <input type="text" class="form-control border-0 py-4" id="search" name="search"
                                        placeholder="Search by name, email, or company..." style="font-size: 1.1rem;">
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-4">
                                <select class="form-select form-select-lg border-0 shadow-lg py-4" name="role"
                                    style="border-radius: 20px; font-size: 1.1rem;">
                                    <option value="">All Perspectives</option>
                                    <option value="student">üéì Students</option>
                                    <option value="alumni">üíº Alumni</option>
                                    <option value="faculty">üë®‚Äçüè´ Faculty</option>
                                </select>
                            </div>
                            <div class="col-lg-2">
                                <button type="submit" class="btn btn-primary btn-lg w-100 py-4 shadow-lg h-100"
                                    style="border-radius: 20px; font-weight: 700;">
                                    Search
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Results Grid -->
        <div class="network-results">
            {% if results %}
            <div class="d-flex justify-content-between align-items-center mb-5" data-aos="fade-up">
                <h3 class="text-white fw-bold mb-0">
                    <span class="badge bg-primary me-2">{{ results | length }}</span> Members Found
                </h3>
            </div>

            <div class="row g-4">
                {% for user in results %}
                <div class="col-lg-4 col-md-6" data-aos="zoom-in" data-aos-delay="{{ loop.index * 50 }}">
                    <div class="card glass-card h-100 overflow-hidden"
                        style="border-radius: 28px; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
                        <div class="card-body p-4 text-center">
                            <div class="avatar-container mb-4 position-relative d-inline-block">
                                <div class="avatar-ring"
                                    style="padding: 6px; background: linear-gradient(45deg, #6366f1, #ec4899); border-radius: 50%;">
                                    <img src="https://ui-avatars.com/api/?name={{ user['name'] }}&size=150&background=1e293b&color=fff&rounded=true"
                                        alt="Profile" class="rounded-circle shadow-lg"
                                        style="width: 110px; height: 110px; border: 4px solid #fff;">
                                </div>
                                <span
                                    class="position-absolute bottom-0 end-0 badge rounded-pill bg-{{ 'success' if user['role'] == 'alumni' else 'primary' if user['role'] == 'student' else 'info' }} p-2"
                                    style="border: 3px solid #1e293b;">
                                    <i
                                        class="fas fa-{{ 'briefcase' if user['role'] == 'alumni' else 'user-graduate' if user['role'] == 'student' else 'chalkboard-teacher' }}"></i>
                                </span>
                            </div>

                            <h4 class="text-white fw-bold mb-1">{{ user['name'] }}</h4>
                            <p class="text-primary small fw-bold text-uppercase mb-3" style="letter-spacing: 1px;">{{
                                user['role'] }}</p>

                            <div class="user-meta mb-4">
                                <div class="d-flex justify-content-center gap-3 mb-2">
                                    <span class="text-white-50 small"><i class="fas fa-envelope me-1"></i> {{
                                        user['email'] }}</span>
                                </div>
                                {% if user['company'] %}
                                <div class="badge bg-white bg-opacity-10 text-white-50 px-3 py-2 rounded-pill">
                                    <i class="fas fa-building me-1"></i> {{ user['company'] }}
                                </div>
                                {% endif %}
                            </div>

                            <div class="card-actions">
                                <div class="row g-2">
                                    <div class="col-8">
                                        {% if user['role'] == 'alumni' %}
                                        <a href="{{ url_for('alumni_profile', user_id=user['id']) }}"
                                            class="btn btn-outline-light w-100 rounded-pill fw-bold">
                                            View Profile
                                        </a>
                                        {% elif user['role'] == 'student' %}
                                        <a href="{{ url_for('student_profile', user_id=user['id']) }}"
                                            class="btn btn-outline-light w-100 rounded-pill fw-bold">
                                            View Profile
                                        </a>
                                        {% elif user['role'] == 'faculty' %}
                                        <a href="{{ url_for('faculty_profile', user_id=user['id']) }}"
                                            class="btn btn-outline-light w-100 rounded-pill fw-bold">
                                            View Profile
                                        </a>
                                        {% endif %}
                                    </div>
                                    <div class="col-4">
                                        <button class="btn btn-primary w-100 rounded-pill shadow-lg"
                                            data-user-id="{{ user['id'] }}" onclick="connectUser(this.dataset.userId)">
                                            <i class="fas fa-user-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            {% else %}
            {% if request.method == 'POST' %}
            <div class="text-center py-5" data-aos="fade-up">
                <div class="mb-4">
                    <i class="fas fa-search-minus text-white-50" style="font-size: 5rem;"></i>
                </div>
                <h2 class="text-white fw-bold">No Connections Found</h2>
                <p class="text-white-50">Try broadening your search or adjusting the perspective filters.</p>
                <a href="{{ url_for('search_network') }}"
                    class="btn btn-link text-primary text-decoration-none fw-bold mt-2">
                    <i class="fas fa-undo me-2"></i> Reset Search
                </a>
            </div>
            {% else %}
            <!-- Initial State (Empty Search) -->
            <div class="row justify-content-center" data-aos="fade-up">
                <div class="col-lg-8">
                    <div class="glass-panel p-5 text-center"
                        style="border-radius: 24px; background: rgba(255,255,255,0.03);">
                        <i class="fas fa-satellite-dish text-primary mb-4" style="font-size: 3rem; opacity: 0.5;"></i>
                        <h3 class="text-white">Start Your Search</h3>
                        <p class="text-white-50 mb-0">Search hundreds of profile to build your professional network at
                            DBIT.</p>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>
</div>

<style>
    .search-network-wrapper {
        background-color: #0f172a !important;
    }

    .text-gradient-purple {
        background: linear-gradient(135deg, #a78bfa 0%, #ec4899 100%);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .glass-panel {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
    }

    .glass-card:hover {
        background: rgba(255, 255, 255, 0.07);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .form-control:focus,
    .form-select:focus {
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.3);
        background-color: #fff;
    }

    .blob {
        position: absolute;
        border-radius: 50%;
        filter: blur(120px);
        z-index: 1;
        animation: floatBlob 20s infinite alternate;
    }

    @keyframes floatBlob {
        0% {
            transform: translate(0, 0) rotate(0deg);
        }

        100% {
            transform: translate(40px, 80px) rotate(15deg);
        }
    }

    .search-form-premium input::placeholder {
        color: #94a3b8;
    }

    .btn-outline-light:hover {
        background: #fff;
        color: #0f172a !important;
        border-color: #fff;
    }
</style>

<script>
    function connectUser(userId) {
        // Shared connect function logic
        fetch('/api/connection-request/send', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `receiver_id=${userId}`
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('Connection request sent!', 'success');
                } else {
                    showToast(data.error || 'Request failed', 'danger');
                }
            });
    }

    function showToast(message, type = 'info') {
        const bgColor = {
            'success': '#10b981', 'danger': '#ef4444', 'info': '#3b82f6'
        };
        const toast = document.createElement('div');
        toast.className = 'position-fixed bottom-0 end-0 m-4';
        toast.style.zIndex = '9999';
        toast.style.animation = 'fadeInUp 0.4s ease';

        toast.innerHTML = `
        <div style="background: ${bgColor[type]}; color: white; padding: 15px 25px; border-radius: 12 px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); font-weight: 600;">
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-info-circle'} me-2"></i>${message}
        </div>`;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.4s ease';
            setTimeout(() => toast.remove(), 400);
        }, 3000);
    }
</script>
{% endblock %}